<div class="record-content" *ngIf="patient">
  <div class="record-section">
    <div class="section-header">
      <h2>Odontogram</h2>
      <button
        mat-icon-button
        class="fhir-floating-button"
        matTooltip="View Dental FHIR Resources"
        (click)="openDentalFhirDialog()">
        <mat-icon fontIcon="data_object"></mat-icon>
      </button>
    </div>

    <div class="view-mode-switch" role="group" aria-label="Odontogram view selector">
      <button
        type="button"
        class="view-mode-button"
        [class.active]="viewMode === 'anatomic'"
        (click)="setViewMode('anatomic')">
        Anatomic View
      </button>
      <button
        type="button"
        class="view-mode-button"
        [class.active]="viewMode === 'rootSurface'"
        (click)="setViewMode('rootSurface')">
        Root Surface View
      </button>
    </div>

    <div class="odontogram-layout">
      <app-dentistry-odontogram-anatomic
        *ngIf="viewMode === 'anatomic'"
        [quadrants]="quadrants"
        [surfaceOptions]="surfaceOptions"
        [hoveredTooth]="hoveredTooth"
        [tooltipX]="tooltipX"
        [tooltipY]="tooltipY"
        [getTeethForQuadrant]="getTeethForQuadrantFn"
        [trackByToothId]="trackByToothIdFn"
        [isSelected]="isSelectedFn"
        [isToothAbsent]="isToothAbsentFn"
        [getLinePaths]="getLinePathsFn"
        [hasSurfaceVisual]="hasSurfaceVisualFn"
        [getSurfaceVisualType]="getSurfaceVisualTypeFn"
        [getSurfaceOverlayClass]="getSurfaceOverlayClassFn"
        [isSurfacePreview]="isSurfacePreviewFn"
        [getSurfaceOverlayPath]="getSurfaceOverlayPathFn"
        [getSurfaceFill]="getSurfaceFillFn"
        [getSurfaceStroke]="getSurfaceStrokeFn"
        [getSurfaceStrokeWidth]="getSurfaceStrokeWidthFn"
        [getToothTooltipLines]="getToothTooltipLinesFn"
        (toothPinned)="pinTooth($event)"
        (toothMouseEnter)="onToothMouseEnter($event.tooth, $event.event)"
        (toothMouseMove)="onToothMouseMove($event)"
        (toothMouseLeave)="onToothMouseLeave()">
      </app-dentistry-odontogram-anatomic>

      <app-dentistry-odontogram-root-surface
        *ngIf="viewMode === 'rootSurface'"
        [getTeethForQuadrant]="getTeethForQuadrantFn"
        [isSelected]="isSelectedFn"
        [isToothAbsent]="isToothAbsentFn"
        [hasSurfaceVisual]="hasSurfaceVisualFn"
        [getSurfaceVisualType]="getSurfaceVisualTypeFn"
        [isSurfacePreview]="isSurfacePreviewFn"
        [hoveredTooth]="hoveredTooth"
        [tooltipX]="tooltipX"
        [tooltipY]="tooltipY"
        [surfaceCodeMesial]="SURFACE_CODE_MESIAL"
        [surfaceCodeDistal]="SURFACE_CODE_DISTAL"
        [surfaceCodeOcclusal]="SURFACE_CODE_OCCLUSAL"
        [surfaceCodeLingual]="SURFACE_CODE_LINGUAL"
        [surfaceCodeVestibular]="SURFACE_CODE_VESTIBULAR"
        [surfaceCodeEntire]="SURFACE_CODE_COMPLETE"
        [surfaceCodePeriodontal]="SURFACE_CODE_PERIODONTAL"
        [getToothTooltipLines]="getToothTooltipLinesFn"
        (toothPinned)="pinTooth($event)"
        (toothMouseEnter)="onToothMouseEnter($event.tooth, $event.event)"
        (toothMouseMove)="onToothMouseMove($event)"
        (toothMouseLeave)="onToothMouseLeave()">
      </app-dentistry-odontogram-root-surface>

      <div class="odontogram-details">
        <mat-tab-group class="dental-side-tabs" [(selectedIndex)]="selectedSideTabIndex">
          <mat-tab label="Selected Tooth">
            <div class="side-tab-content">
              <app-dentistry-data-entry-panel
                [pinnedTooth]="pinnedTooth"
                [surfaceOnlyOptions]="getSurfaceOnlyOptions()"
                [selectedSiteCodes]="getPinnedSiteCodes()"
                [completeSiteCode]="SURFACE_CODE_COMPLETE"
                [periodontalSiteCode]="SURFACE_CODE_PERIODONTAL"
                [findingQuery]="getPinnedFindingQuery()"
                [filteredFindingOptions]="getFilteredFindingOptions()"
                [entryType]="getPinnedEntryType()"
                [canSave]="canSavePinnedFindingEntry()"
                [saveDisabledReason]="getSaveDisabledReason()"
                [isSaved]="isPinnedEntrySaved()"
                [pinnedToothSavedFindings]="getPinnedToothSavedFindings()"
                (exclusiveSiteToggle)="onExclusiveSiteToggle($event.siteCode, $event.checked)"
                (surfaceSiteToggle)="onSurfaceSiteToggle($event.siteCode, $event.checked)"
                (findingInputChange)="onFindingInputChange($event)"
                (findingSelected)="onFindingSelected($event)"
                (entryTypeChange)="onEntryTypeChange($event)"
                (save)="savePinnedFindingEntry()"
                (resolveFinding)="resolveSavedFinding($event)"
                (deleteFinding)="deleteSavedFinding($event)"
                (copyPostcoordinated)="copyPostcoordinatedExpression($event)">
              </app-dentistry-data-entry-panel>
            </div>

          </mat-tab>

          <mat-tab label="All Records">
            <app-dentistry-all-findings-list
              [items]="getDentalObservationList()"
              (resolveFinding)="resolveSavedFinding($event)"
              (deleteFinding)="deleteSavedFinding($event)"
              (focusFinding)="focusObservationTooth($event)"
              (copyPostcoordinated)="copyPostcoordinatedExpression($event)">
            </app-dentistry-all-findings-list>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>
</div>
