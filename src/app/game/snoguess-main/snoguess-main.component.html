<div class="snoguess-game" *ngIf="(game | async) as gameState">
  <h2>Guess the SNOMED Term</h2>
  
  <div class="term-display" *ngIf="gameState.state != 'loading'">
      <span *ngFor="let char of gameState.displayTerm">{{ char }}</span>
  </div>
  
  <div *ngIf="gameState.state === 'loading'" class="loading-container">
    <div class="progress-bar-message">
      Choosing a random SNOMED CT concept using the FHIR API
    </div>
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  
  <div class="hit-points">
    <span *ngFor="let hp of [].constructor(gameState.hitPoints); let i = index">
        <mat-icon [@heartAnimation]="gameState.hitPoints > i ? 'filled' : 'empty'">favorite</mat-icon>
    </span>
    <span *ngFor="let hp of [].constructor(gameState.maxHitPoints - gameState.hitPoints); let i = index">
        <mat-icon [@heartAnimation]="'empty'">favorite_border</mat-icon>
    </span>
  </div>

  
  <div>
    <div class="guess-field">
      <mat-form-field appearance="fill" [@shake]="shakeState">
        <mat-label>Guess a letter</mat-label>
        <input matInput #letterInput maxlength="1" (input)="letterInput.value = letterInput.value.slice(0, 1)" (keyup.enter)="guessLetter(letterInput.value); letterInput.value=''" [disabled]="gameState.state !== 'playing'">
      </mat-form-field>
      <button mat-flat-button color="accent" (click)="guessLetter(letterInput.value); letterInput.value=''" [disabled]="gameState.state !== 'playing'">Guess</button>
    </div>
      
      <div class="guess-field">
        <mat-form-field appearance="fill">
          <mat-label>Guess the full term</mat-label>
          <!-- Disable the input field when the game state is not 'playing' -->
          <input matInput #fullTermInput (keyup.enter)="guessTerm(fullTermInput.value); fullTermInput.value=''" [disabled]="gameState.state !== 'playing'">
        </mat-form-field>
        <!-- Disable the button when the game state is not 'playing' -->
        <button mat-flat-button color="accent" (click)="guessTerm(fullTermInput.value); fullTermInput.value=''" [disabled]="gameState.state !== 'playing'">Guess</button>
      </div>
      <br>
      <div class="guess-field">
        <!-- Disable the button when the game state is not 'playing' -->
        <button mat-flat-button color="accent" (click)="revealHint()" [disabled]="gameState.state !== 'playing'">Reveal Hint</button>
        <button mat-flat-button color="accent" (click)="initialize()" [disabled]="gameState.state !== 'playing'">Reset</button>
      </div>

      <div *ngIf="gameState.hints.length > 0">
          <h3>Hints</h3>
          <ul>
              <li *ngFor="let hint of gameState.hints">{{ hint }}</li>
          </ul>
      </div>
  </div>
  <div *ngIf="gameState.state === 'won'" class="overlay">
    <div class="pyro">
      <div class="before"></div>
      <div class="after"></div>
    </div>
    <div class="message won">You won!</div>
    <div class="reveal won">{{ gameState.term }}</div>
    <button mat-flat-button color="primary" (click)="initialize()">Try Again</button>
  </div>

  <!-- Overlay for "Lost" state -->
  <div *ngIf="gameState.state === 'lost'" class="overlay">
    <div class="fixed top-0 left-0 z-5">
      <div class="drop" style="--i:1"></div>
      <div class="drop" style="--i:2"></div>
      <div class="drop" style="--i:3"></div>
      <div class="drop" style="--i:4"></div>
      <div class="drop" style="--i:5"></div>
      <div class="drop" style="--i:6"></div>
      <div class="drop" style="--i:7"></div>
      <div class="drop" style="--i:8"></div>
      <div class="drop" style="--i:9"></div>
      <div class="drop" style="--i:10"></div>
      <div class="drop" style="--i:11"></div>
      <div class="drop" style="--i:12"></div>
      <div class="drop" style="--i:13"></div>
      <div class="drop" style="--i:14"></div>
      <div class="drop" style="--i:15"></div>
      <div class="drop" style="--i:16"></div>
      <div class="drop" style="--i:17"></div>
      <div class="drop" style="--i:18"></div>
      <div class="drop" style="--i:19"></div>
      <div class="drop" style="--i:20"></div>
      <div class="drop" style="--i:21"></div>
      <div class="drop" style="--i:22"></div>
      <div class="drop" style="--i:23"></div>
      <div class="drop" style="--i:24"></div>
      <div class="drop" style="--i:25"></div>
      <div class="drop" style="--i:26"></div>
      <div class="drop" style="--i:27"></div>
      <div class="drop" style="--i:28"></div>
      <div class="drop" style="--i:29"></div>
      <div class="drop" style="--i:30"></div>
      <div class="drop" style="--i:31"></div>
      <div class="drop" style="--i:32"></div>
      <div class="drop" style="--i:33"></div>
      <div class="drop" style="--i:34"></div>
      <div class="drop" style="--i:35"></div>
      <div class="drop" style="--i:36"></div>
      <div class="drop" style="--i:37"></div>
      <div class="drop" style="--i:38"></div>
      <div class="drop" style="--i:39"></div>
      <div class="drop" style="--i:40"></div>
      <div class="drop" style="--i:41"></div>
      <div class="drop" style="--i:42"></div>
      <div class="drop" style="--i:43"></div>
      <div class="drop" style="--i:44"></div>
      <div class="drop" style="--i:45"></div>
      <div class="drop" style="--i:46"></div>
      <div class="drop" style="--i:47"></div>
      <div class="drop" style="--i:48"></div>
      <div class="drop" style="--i:49"></div>
      <div class="drop" style="--i:50"></div>
    </div>
    <div class="message lost">You have lost!</div>
    <div class="reveal lost">{{ gameState.term }}</div>
    <button mat-flat-button color="warn" (click)="initialize()">Try Again</button>
  </div>
</div>
